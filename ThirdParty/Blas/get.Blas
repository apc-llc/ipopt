#!/bin/sh

set -e

wgetcmd="wget"
wgetcount=`which wget 2>/dev/null | wc -l`
if test ! $wgetcount = 1; then
  echo "Utility wget not found in your PATH."
  if test `uname` = Darwin; then
    wgetcmd="curl -L -k -O"
    echo "Using ftp command instead."
  elif test `uname` = FreeBSD; then
    wgetcmd=fetch
    echo "Using fetch command instead."
  else
    exit -1
  fi
fi

coinblas=blas-20130815.tgz

echo " "
echo "Running script for preparing the source code for BLAS"
echo " "

if [ ! -e blas.fetch ]; then
  echo "Downloading the source code from projects.coin-or.org..."
  if $wgetcmd http://www.coin-or.org/BuildTools/Blas/$coinblas && touch blas.fetch ;
  then
    mv $coinblas blas.tgz
  else
    echo
    echo "Failed, try downloading the source code from www.netlib.org..."
    if ! ( $wgetcmd http://www.netlib.org/blas/blas.tgz && touch blas.fetch ) ;
    then
      echo
      echo "Failed, try downloading the source code from netlib.sandia.gov..."
      if ! ( $wgetcmd http://netlib.sandia.gov/blas/blas.tgz && touch blas.fetch ) ;
      then
        exit 1;
      fi
    fi
  fi
fi

echo "Unpacking the source code..."
tar -xf blas.tgz

echo "Moving the source files from BLAS subdirectory"
mv BLAS/*.f .
rm -rf BLAS

echo " "
echo "Done preparing the source code for BLAS."
echo " "

